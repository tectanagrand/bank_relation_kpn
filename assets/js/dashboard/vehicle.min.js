/*
Template Name: Color Admin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3 & 4
Version: 4.1.0
Author: Sean Ngu
Website: http://www.seantheme.com/color-admin-v4.1/admin/
*/

var fcba = 'ALL';
var division = '';

function save() {	
	fcba = $('#businessunit').val();
	division  = $('#division').val();
	year  = $('#tahun').val();
	month  = $('#bulan').val();
	ChartNvd3.init();
}

var handlePieAndDonutChart=function(){
	"use strict";
	
	
	if (fcba == 'ALL') {
			var url = 'http://localhost:88/IPLAS/index.php/Dashboardvehicle/chart_estate_vehicle';
	}else{
		if (division == 'ALL'){
			var url = 'http://localhost:88/IPLAS/index.php/Dashboardvehicle/chart_estate_vehicle_fcba/'+ year +'/' + month +'/'+ fcba;
		}else{
			var url = 'http://localhost:88/IPLAS/index.php/Dashboardvehicle/chart_estate_vehicle_det/'+ year +'/' + month +'/' + fcba +'/' + division;
		}
	}
	var e=[];
		$.ajax({
			type: 'GET',
			url : url,
			dataType: 'json',
			contentType: "application/json;charset=UTF-8",
			success: function (result) {
				$.each(result, function (i, obj) {
					
					$('#lblKTR').text((obj.KG_CONTRACT/obj.KG_TOTAL*100).toFixed(0)+" %");
					$('#lblDT').text((obj.KG_DT/obj.KG_TOTAL*100).toFixed(0)+" %");
					$('#lblTN').text((obj.KG_TN/obj.KG_TOTAL*100).toFixed(0)+" %");
					
					e=[{label : "Contractor",value:obj.KG_CONTRACT/obj.KG_TOTAL*100,color:'#e11b1b'},
					{label : "Dump Truck", value:obj.KG_DT/obj.KG_TOTAL*100,color:COLOR_YELLOW},
					{label : "Triton", value:obj.KG_TN/obj.KG_TOTAL*100,color:'#32a932'}];
				
					nv.addGraph(function(){
						d3.select("svg").remove(); 
						var a=nv.models.pieChart().x(function(e){ return e.label }).y(function(e){return e.value}).showLabels(!0).labelThreshold(.05).labelType("percent");						
						return d3.select("#nv-pie-chart").append("svg").datum(e).transition().duration(350).call(a),a})
				});
			}
		});
	},
	  ChartNvd3=function(){
		"use strict";return{
			init:function(){
				handlePieAndDonutChart()
				}
			}
		}();